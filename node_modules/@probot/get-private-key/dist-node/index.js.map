{"version":3,"file":"index.js","sources":["../dist-src/version.js","../dist-src/index.js"],"sourcesContent":["export const VERSION = \"0.0.0-development\";\n","import { resolve } from \"path\";\nimport { existsSync, readdirSync, readFileSync } from \"fs\";\nimport isBase64 from \"is-base64\";\nimport { VERSION } from \"./version\";\nconst begin = \"-----BEGIN RSA PRIVATE KEY-----\";\nconst end = \"-----END RSA PRIVATE KEY-----\";\nexport function getPrivateKey(options = {}) {\n    const env = options.env || process.env;\n    const cwd = options.cwd || process.cwd();\n    if (options.filepath) {\n        return readFileSync(resolve(cwd, options.filepath), \"utf-8\");\n    }\n    if (env.PRIVATE_KEY) {\n        let privateKey = env.PRIVATE_KEY;\n        if (isBase64(privateKey)) {\n            // Decode base64-encoded certificate\n            privateKey = Buffer.from(privateKey, \"base64\").toString();\n        }\n        if (privateKey.includes(begin) && privateKey.includes(end)) {\n            // newlines are escaped\n            if (privateKey.indexOf(\"\\\\n\") !== -1) {\n                privateKey = privateKey.replace(/\\\\n/g, \"\\n\");\n            }\n            // newlines are missing\n            if (privateKey.indexOf(\"\\n\") === -1) {\n                privateKey = addNewlines(privateKey);\n            }\n            return privateKey;\n        }\n        throw new Error(`[@probot/get-private-key] The contents of \"env.PRIVATE_KEY\" could not be validated. Please check to ensure you have copied the contents of the .pem file correctly.`);\n    }\n    if (env.PRIVATE_KEY_PATH) {\n        const filepath = resolve(cwd, env.PRIVATE_KEY_PATH);\n        if (existsSync(filepath)) {\n            return readFileSync(filepath, \"utf-8\");\n        }\n        else {\n            throw new Error(`[@probot/get-private-key] Private key does not exists at path: \"${env.PRIVATE_KEY_PATH}\". Please check to ensure that \"env.PRIVATE_KEY_PATH\" is correct.`);\n        }\n    }\n    const pemFiles = readdirSync(cwd).filter((path) => path.endsWith(\".pem\"));\n    if (pemFiles.length > 1) {\n        const paths = pemFiles.join(\", \");\n        throw new Error(`[@probot/get-private-key] More than one file found: \"${paths}\". Set { filepath } option or set one of the environment variables: PRIVATE_KEY, PRIVATE_KEY_PATH`);\n    }\n    else if (pemFiles[0]) {\n        return getPrivateKey({ filepath: pemFiles[0], cwd });\n    }\n    return null;\n}\nfunction addNewlines(privateKey) {\n    const middleLength = privateKey.length - begin.length - end.length - 2;\n    const middle = privateKey.substr(begin.length + 1, middleLength);\n    return `${begin}\\n${middle.trim().replace(/\\s+/g, \"\\n\")}\\n${end}`;\n}\ngetPrivateKey.VERSION = VERSION;\n"],"names":["VERSION","begin","end","getPrivateKey","options","env","process","cwd","filepath","readFileSync","resolve","PRIVATE_KEY","privateKey","isBase64","Buffer","from","toString","includes","indexOf","replace","addNewlines","Error","PRIVATE_KEY_PATH","existsSync","pemFiles","readdirSync","filter","path","endsWith","length","paths","join","middleLength","middle","substr","trim"],"mappings":"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"}