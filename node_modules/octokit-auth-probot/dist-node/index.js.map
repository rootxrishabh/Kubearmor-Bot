{"version":3,"file":"index.js","sources":["../dist-src/auth.js","../dist-src/get-state.js","../dist-src/version.js","../dist-src/index.js"],"sourcesContent":["import { createUnauthenticatedAuth } from \"@octokit/auth-unauthenticated\";\nexport async function auth(state, options) {\n    // return authentication from internal auth instance unless the event is \"event-octokit\"\n    if (options.type !== \"event-octokit\") {\n        if (state.type === \"token\" &&\n            options.type === \"installation\" &&\n            options.factory) {\n            const { type, factory, ...factoryAuthOptions } = options;\n            // @ts-expect-error - factory is typed as never because the `@octokit/auth-app` types are ... complicated.\n            return factory(Object.assign({}, factoryAuthOptions, {\n                octokit: state.octokit,\n                octokitOptions: state.octokitOptions,\n            }));\n        }\n        return state.auth(options);\n    }\n    // unless the internal event type is \"app\", return the octokit\n    // instance passed as strategy option\n    if (state.type !== \"app\") {\n        return state.octokit;\n    }\n    const action = options.event.payload.action;\n    const installationId = options.event.payload.installation && options.event.payload.installation.id;\n    const fullEventName = options.event.name + (action ? \".\" + action : \"\");\n    const OctokitWithEventAuth = state.octokit\n        .constructor;\n    if (!installationId) {\n        const { auth, ...octokitOptions } = state.octokitOptions;\n        return new OctokitWithEventAuth({\n            authStrategy: createUnauthenticatedAuth,\n            auth: {\n                reason: `Handling a \"${fullEventName}\" event: an \"installation\" key is missing. The installation ID cannot be determined`,\n            },\n            ...octokitOptions,\n        });\n    }\n    if (options.event.name === \"installation\" &&\n        [\"suspend\", \"deleted\"].includes(String(action))) {\n        const { auth, ...octokitOptions } = state.octokitOptions;\n        return new OctokitWithEventAuth({\n            authStrategy: createUnauthenticatedAuth,\n            auth: {\n                reason: `Handling a \"${fullEventName}\" event: The app's access has been revoked from @octokit (id: ${installationId})`,\n            },\n            ...octokitOptions,\n        });\n    }\n    // otherwise create a pre-authenticated (or unauthenticated) Octokit instance\n    // depending on the event payload\n    return state.auth({\n        type: \"installation\",\n        installationId,\n        factory: (auth) => {\n            const options = Object.assign({}, state.octokitOptions, {\n                auth: Object.assign({}, auth, {\n                    installationId,\n                }),\n            });\n            return new OctokitWithEventAuth(options);\n        },\n    });\n}\n","import { createTokenAuth } from \"@octokit/auth-token\";\nimport { createAppAuth } from \"@octokit/auth-app\";\nimport { createUnauthenticatedAuth } from \"@octokit/auth-unauthenticated\";\nexport function getState(options) {\n    const common = {\n        octokit: options.octokit,\n        octokitOptions: options.octokitOptions,\n    };\n    if (\"token\" in options) {\n        return {\n            type: \"token\",\n            auth: createTokenAuth(String(options.token)),\n            ...common,\n        };\n    }\n    if (\"appId\" in options && \"privateKey\" in options) {\n        return {\n            type: \"app\",\n            auth: createAppAuth(options),\n            ...common,\n        };\n    }\n    return {\n        type: \"unauthenticated\",\n        auth: createUnauthenticatedAuth({\n            reason: `Neither \"appId\"/\"privateKey\" nor \"token\" have been set as auth options`,\n        }),\n        ...common,\n    };\n}\n","export const VERSION = \"0.0.0-development\";\n","import { auth } from \"./auth\";\nimport { getState } from \"./get-state\";\nimport { VERSION } from \"./version\";\nexport function createProbotAuth(options) {\n    const state = getState(options);\n    return Object.assign(auth.bind(null, state), {\n        hook: state.auth.hook,\n    });\n}\ncreateProbotAuth.VERSION = VERSION;\n"],"names":["auth","state","options","type","factory","factoryAuthOptions","Object","assign","octokit","octokitOptions","action","event","payload","installationId","installation","id","fullEventName","name","OctokitWithEventAuth","constructor","authStrategy","createUnauthenticatedAuth","reason","includes","String","getState","common","createTokenAuth","token","createAppAuth","VERSION","createProbotAuth","bind","hook"],"mappings":"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"}